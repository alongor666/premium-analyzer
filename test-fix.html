<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¿®å¤éªŒè¯æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #a02724;
      border-bottom: 3px solid #a02724;
      padding-bottom: 10px;
    }
    h2 {
      color: #2c2c2c;
      margin-top: 0;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 10px;
    }
    .pass {
      background: #d4edda;
      color: #155724;
    }
    .fail {
      background: #f8d7da;
      color: #721c24;
    }
    .test-item {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    .test-item:last-child {
      border-bottom: none;
    }
    button {
      background: #a02724;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #8a1f1c;
    }
    #results {
      white-space: pre-wrap;
      font-family: monospace;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ ä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢</h1>

  <div class="test-card">
    <h2>Bug ä¿¡æ¯</h2>
    <div class="test-item">
      <strong>é”™è¯¯æ¶ˆæ¯:</strong> <code>[ChartService] å®¹å™¨ä¸å­˜åœ¨: chartTopOrganizations</code>
    </div>
    <div class="test-item">
      <strong>æ ¹æœ¬åŸå› :</strong> æ¶æ„è¿ç§»åçš„é—ç•™ä»£ç è¯•å›¾æ¸²æŸ“åˆ°å·²åˆ é™¤çš„å®¹å™¨
    </div>
    <div class="test-item">
      <strong>ä¿®å¤çŠ¶æ€:</strong> <span class="status pass">å·²ä¿®å¤</span>
    </div>
  </div>

  <div class="test-card">
    <h2>è‡ªåŠ¨éªŒè¯æµ‹è¯•</h2>
    <button onclick="runTests()">è¿è¡Œæµ‹è¯•</button>
    <button onclick="window.location.href='/'">æ‰“å¼€ä¸»åº”ç”¨</button>
    <div id="results"></div>
  </div>

  <div class="test-card">
    <h2>æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤</h2>
    <ol>
      <li>ç‚¹å‡» "æ‰“å¼€ä¸»åº”ç”¨" æŒ‰é’®</li>
      <li>ä¸Šä¼ æµ‹è¯•æ•°æ®æ–‡ä»¶: <code>test-data.csv</code></li>
      <li>éªŒè¯æ¦‚è§ˆé¡µçš„æœˆåº¦è¶‹åŠ¿å›¾æ­£å¸¸æ˜¾ç¤º</li>
      <li>åˆ‡æ¢åˆ° "æŸ±çŠ¶å›¾" æ ‡ç­¾é¡µï¼ŒéªŒè¯å›¾è¡¨æ­£å¸¸æ˜¾ç¤º</li>
      <li>åˆ‡æ¢åˆ° "å æ¯”å›¾" æ ‡ç­¾é¡µï¼ŒéªŒè¯ç«ç‘°å›¾æ­£å¸¸æ˜¾ç¤º</li>
      <li>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œç¡®è®¤æ²¡æœ‰ "å®¹å™¨ä¸å­˜åœ¨" é”™è¯¯</li>
      <li>åº”ç”¨ç­›é€‰æ¡ä»¶ï¼ŒéªŒè¯å›¾è¡¨æ›´æ–°æ­£å¸¸</li>
    </ol>
  </div>

  <script>
    function runTests() {
      const results = document.getElementById('results');
      results.textContent = 'æ­£åœ¨è¿è¡Œæµ‹è¯•...\n\n';

      const tests = [
        {
          name: 'éªŒè¯æ—§å®¹å™¨ä¸å­˜åœ¨',
          test: () => !document.getElementById('chartTopOrganizations'),
          expected: true
        },
        {
          name: 'éªŒè¯ chartMonthTrend å®¹å™¨å­˜åœ¨',
          test: () => {
            // éœ€è¦åœ¨ä¸»é¡µé¢ä¸­éªŒè¯
            return fetch('/')
              .then(r => r.text())
              .then(html => html.includes('id="chartMonthTrend"'));
          },
          expected: true
        },
        {
          name: 'éªŒè¯ chartBarMain å®¹å™¨å­˜åœ¨',
          test: () => {
            return fetch('/')
              .then(r => r.text())
              .then(html => html.includes('id="chartBarMain"'));
          },
          expected: true
        },
        {
          name: 'éªŒè¯ chartRatioMain å®¹å™¨å­˜åœ¨',
          test: () => {
            return fetch('/')
              .then(r => r.text())
              .then(html => html.includes('id="chartRatioMain"'));
          },
          expected: true
        },
        {
          name: 'éªŒè¯ app.js ä¸åŒ…å« chartTopOrganizations',
          test: () => {
            return fetch('/js/app.js')
              .then(r => r.text())
              .then(code => !code.includes('chartTopOrganizations'));
          },
          expected: true
        },
        {
          name: 'éªŒè¯ app.js åŒ…å« renderTabContent',
          test: () => {
            return fetch('/js/app.js')
              .then(r => r.text())
              .then(code => code.includes('renderTabContent'));
          },
          expected: true
        }
      ];

      let passed = 0;
      let failed = 0;

      Promise.all(tests.map(async (t, i) => {
        try {
          const result = await t.test();
          const status = result === t.expected ? 'âœ… PASS' : 'âŒ FAIL';
          if (result === t.expected) passed++;
          else failed++;

          results.textContent += `${i + 1}. ${t.name}: ${status}\n`;
        } catch (error) {
          failed++;
          results.textContent += `${i + 1}. ${t.name}: âŒ ERROR - ${error.message}\n`;
        }
      })).then(() => {
        results.textContent += `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        results.textContent += `æ€»è®¡: ${tests.length} ä¸ªæµ‹è¯•\n`;
        results.textContent += `é€šè¿‡: ${passed} âœ…\n`;
        results.textContent += `å¤±è´¥: ${failed} âŒ\n`;

        if (failed === 0) {
          results.textContent += `\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ä¿®å¤éªŒè¯æˆåŠŸï¼\n`;
        } else {
          results.textContent += `\nâš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¿®å¤ã€‚\n`;
        }
      });
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
    window.addEventListener('load', () => {
      setTimeout(runTests, 500);
    });
  </script>
</body>
</html>
